# Teste Full Stack - Ger Financeiro Solu√ß√µes

Este projeto √© uma implementa√ß√£o completa do desafio descrito em:  
**üîó [https://github.com/gerfinanceirosolucoes/teste-full-stack](https://github.com/gerfinanceirosolucoes/teste-full-stack)**

---

## üêã **Ambiente Dockerizado**

Este projeto roda completamente em Docker, facilitando a configura√ß√£o e execu√ß√£o em qualquer ambiente.

### **Tecnologias e Vers√µes Utilizadas**

| Tecnologia | Vers√£o | Descri√ß√£o |
|------------|--------|-----------|
| **Docker** | 3.8 | Containeriza√ß√£o do ambiente |
| **PHP** | 7.4 | Backend runtime com Apache |
| **Laravel** | 5.4 | Framework PHP (Janeiro 2017) |
| **MariaDB** | 10.5 | Banco de dados |
| **Angular** | Latest | Frontend framework |
| **Bootstrap** | Latest | Framework CSS |
| **Apache** | 2.4 | Servidor web integrado |

---

## ‚ö†Ô∏è **Observa√ß√µes Importantes**

### **Laravel 5.4 - Vers√£o Legada**

Este projeto utiliza **Laravel 5.4** (lan√ßado em Janeiro de 2017), uma vers√£o com mais de 7 anos. Devido a esta escolha, algumas implementa√ß√µes especiais foram necess√°rias:

#### **Compatibilidades Implementadas:**
- ‚úÖ **Autentica√ß√£o por tokens simples** (sem Laravel Passport)
- ‚úÖ **Middleware personalizado** para PHP 7.4+
- ‚úÖ **Comando personalizado** para listar rotas (`route:list-custom`)
- ‚úÖ **Corre√ß√µes de compatibilidade** para novas vers√µes do PHP
- ‚úÖ **Sistema de fallback** para funcionalidades n√£o dispon√≠veis

#### **Limita√ß√µes da Vers√£o:**
- ‚ùå N√£o possui helper `now()` (usamos `Carbon::now()`)
- ‚ùå Alguns middlewares modernos n√£o existem
- ‚ùå Laravel Passport n√£o est√° dispon√≠vel nesta vers√£o
- ‚ùå Sintaxes mais modernas do Eloquent podem n√£o funcionar

---

## üöÄ **Como Executar o Projeto**

### **Pr√©-requisitos**
- Docker
- Docker Compose

### **Comandos para Execu√ß√£o**

```bash
# Clonar o reposit√≥rio
git clone [seu-reposit√≥rio]
cd teste-full-stack

# Executar com Docker Compose
docker-compose up --build

# Aguardar todos os servi√ßos subirem
# Frontend: http://localhost:4200
# Backend API: http://localhost:8000
# Banco de dados: localhost:3306 (MariaDB)
```

### **Configura√ß√£o Inicial**

```bash
# Entrar no container do backend
docker exec -it backend_app bash

# Instalar depend√™ncias do Composer (se necess√°rio)
composer install

# Configurar permiss√µes
chown -R www-data:www-data /var/www/html
chmod -R 775 storage bootstrap/cache

# Rodar migra√ß√µes
php artisan migrate

# (Opcional) Criar dados de exemplo
php artisan db:seed
```

---

## üìö **Documenta√ß√£o da API**

### **Base URL**
```
http://localhost:8000/api
```

### **Autentica√ß√£o**
A API utiliza **Bearer Token**. Inclua o token no header das requisi√ß√µes protegidas:
```
Authorization: Bearer {seu_token}
```

### **Testando com Postman**
Uma collection completa do Postman est√° dispon√≠vel no arquivo:
```
backend/Postman_collection.json
```

**Como usar:**
1. Abra o Postman
2. Clique em **Import** 
3. Selecione o arquivo `backend/Postman_collection.json`
4. Configure as vari√°veis de ambiente:
   - `base_url`: `http://localhost:8000`
   - `token`: (ser√° preenchido automaticamente ap√≥s login)

A collection inclui todos os endpoints documentados com exemplos de requisi√ß√µes e vari√°veis autom√°ticas.

---

## üîì **Endpoints P√∫blicos**

### **Teste e Status**

#### `GET /api/test`
Testa se a API est√° funcionando.

**Resposta:**
```json
{
  "message": "API funcionando!",
  "timestamp": "2025-01-15 10:30:00",
  "laravel_version": "5.4.36"
}
```

#### `GET /api/status`
Retorna status detalhado da API.

**Resposta:**
```json
{
  "api": "Sistema de Cl√≠nicas API",
  "version": "1.0.0",
  "status": "online",
  "timestamp": "2025-01-15 10:30:00",
  "laravel_version": "5.4.36"
}
```

### **Autentica√ß√£o**

#### `POST /api/register`
Registra um novo usu√°rio no sistema.

**Body:**
```json
{
  "nome": "Jo√£o Silva",
  "email": "joao@exemplo.com",
  "password": "123456",
  "password_confirmation": "123456"
}
```

**Resposta de Sucesso:**
```json
{
  "success": true,
  "message": "Usu√°rio registrado com sucesso",
  "data": {
    "user": {
      "id": 1,
      "nome": "Jo√£o Silva",
      "email": "joao@exemplo.com",
      "ativo": true
    },
    "token": "hash_do_token_aqui",
    "token_type": "Bearer"
  }
}
```

#### `POST /api/login`
Realiza login do usu√°rio.

**Body:**
```json
{
  "email": "joao@exemplo.com",
  "password": "123456"
}
```

**Resposta de Sucesso:**
```json
{
  "success": true,
  "message": "Login realizado com sucesso",
  "data": {
    "user": {
      "id": 1,
      "nome": "Jo√£o Silva",
      "email": "joao@exemplo.com",
      "ativo": true
    },
    "token": "hash_do_token_aqui",
    "token_type": "Bearer"
  }
}
```

---

## üîí **Endpoints Protegidos**

*Requerem token de autentica√ß√£o no header*

### **Gerenciamento de Usu√°rio**

#### `GET /api/me`
Retorna dados do usu√°rio autenticado.

#### `POST /api/logout`
Realiza logout (revoga o token atual).

#### `POST /api/refresh`
Renova o token de acesso.

#### `POST /api/change-password`
Altera a senha do usu√°rio.

**Body:**
```json
{
  "current_password": "123456",
  "new_password": "654321",
  "new_password_confirmation": "654321"
}
```

### **CRUD de Recursos**

#### **Entidades** (`/api/entidades`)
- `GET /api/entidades` - Lista todas as entidades
- `POST /api/entidades` - Cria nova entidade
- `GET /api/entidades/{id}` - Mostra entidade espec√≠fica
- `PUT /api/entidades/{id}` - Atualiza entidade
- `DELETE /api/entidades/{id}` - Remove entidade

#### **Especialidades** (`/api/especialidades`)
- `GET /api/especialidades` - Lista todas as especialidades
- `POST /api/especialidades` - Cria nova especialidade
- `GET /api/especialidades/{id}` - Mostra especialidade espec√≠fica
- `PUT /api/especialidades/{id}` - Atualiza especialidade
- `DELETE /api/especialidades/{id}` - Remove especialidade

#### **Usu√°rios** (`/api/users`)
- `GET /api/users` - Lista todos os usu√°rios (admin)
- `POST /api/users` - Cria novo usu√°rio (admin)
- `GET /api/users/{id}` - Mostra usu√°rio espec√≠fico (admin)
- `PUT /api/users/{id}` - Atualiza usu√°rio (admin)
- `DELETE /api/users/{id}` - Remove usu√°rio (admin)

### **Rotas Auxiliares**

#### `GET /api/entidades-regionais`
Lista entidades organizadas por regi√£o.

#### `GET /api/entidades-especialidades`
Lista especialidades por entidade.

### **Dashboard e Estat√≠sticas**

#### `GET /api/dashboard/stats`
Retorna estat√≠sticas gerais do sistema.

**Resposta:**
```json
{
  "success": true,
  "data": {
    "usuarios": {
      "total": 150,
      "ativos": 140,
      "inativos": 10,
      "novos_ultimo_mes": 25
    },
    "entidades": {
      "total": 45
    },
    "especialidades": {
      "total": 20
    },
    "sistema": {
      "versao": "1.0.0",
      "uptime": "15 dias, 8 horas, 30 minutos",
      "ultima_atualizacao": "2025-01-15 10:30:00"
    }
  }
}
```

#### `GET /api/dashboard/entidades-por-regional`
Retorna entidades agrupadas por regi√£o do Brasil.

**Resposta:**
```json
{
  "success": true,
  "data": [
    {"regiao": "Sudeste", "total": 35},
    {"regiao": "Sul", "total": 20},
    {"regiao": "Nordeste", "total": 28},
    {"regiao": "Norte", "total": 12},
    {"regiao": "Centro-Oeste", "total": 15}
  ],
  "total": 110
}
```

#### `GET /api/dashboard/especialidades-populares?limit=5`
Retorna as especialidades mais populares.

**Par√¢metros de Query:**
- `limit` (opcional): N√∫mero de especialidades a retornar (padr√£o: 10)

**Resposta:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "nome": "Cardiologia",
      "total_uso": 150,
      "percentual": 75.0
    },
    {
      "id": 2,
      "nome": "Pediatria",
      "total_uso": 130,
      "percentual": 65.0
    }
  ],
  "meta": {
    "limit": 5,
    "total_registros": 2
  }
}
```

---

## üõ†Ô∏è **Ferramentas de Desenvolvimento**

### **Comando Personalizado para Listar Rotas**

Devido √†s limita√ß√µes do Laravel 5.4 com PHP 7.4+, foi criado um comando personalizado:

```bash
# Listar todas as rotas
php artisan route:list-custom

# Filtrar apenas rotas da API
php artisan route:list-custom --path=api

# Filtrar rotas do dashboard
php artisan route:list-custom --path=dashboard
```

### **Limpeza de Cache**

```bash
php artisan route:clear
php artisan config:clear
php artisan cache:clear
```

---

## üß™ **Testando a API**

### **Exemplo com cURL**

```bash
# 1. Registrar usu√°rio
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d '{"nome": "Teste", "email": "admin@clinicas.com", "password": "123456", "password_confirmation": "123456"}'

# 2. Fazer login (guardar o token retornado)
curl -X POST http://localhost:8000/api/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@clinicas.com", "password": "123456"}'

# 3. Acessar dados do usu√°rio (usar o token obtido)
curl -H "Authorization: Bearer SEU_TOKEN_AQUI" http://localhost:8000/api/me

# 4. Ver estat√≠sticas do dashboard
curl -H "Authorization: Bearer SEU_TOKEN_AQUI" http://localhost:8000/api/dashboard/stats
```

### **C√≥digos de Resposta HTTP**

| C√≥digo | Significado |
|--------|-------------|
| `200` | Sucesso |
| `201` | Criado com sucesso |
| `401` | N√£o autorizado (token inv√°lido/ausente) |
| `403` | Usu√°rio inativo |
| `404` | N√£o encontrado |
| `422` | Erro de valida√ß√£o |
| `500` | Erro interno do servidor |

---

## üèóÔ∏è **Arquitetura Docker**

### **Servi√ßos Containerizados**

```yaml
# docker-compose.yml
services:
  backend:        # PHP 7.4 + Apache + Laravel 5.4
  frontend:       # Node.js + Angular
  db:             # MariaDB 10.5
```

### **Portas Expostas**
- **Frontend (Angular)**: `http://localhost:4200`
- **Backend (Laravel + Apache)**: `http://localhost:8000`  
- **Banco de Dados (MariaDB)**: `localhost:3306`

### **Volumes Persistentes**
- `./backend:/var/www/html` - C√≥digo do backend
- `./frontend:/app` - C√≥digo do frontend  
- `dbdata:/var/lib/mysql` - Dados do banco de dados

---

## üèóÔ∏è **Estrutura do Projeto**

```
‚îú‚îÄ‚îÄ backend/                    # Laravel 5.4 + PHP 7.4
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ API/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DashboardController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Console/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Commands/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ CustomRouteList.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.php             # Endpoints da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web.php             # Rotas web (comentadas)
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ public/                 # DocumentRoot do Apache
‚îú‚îÄ‚îÄ frontend/                   # Angular + Bootstrap
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ php/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile          # PHP 7.4 + Apache
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îî‚îÄ‚îÄ Dockerfile          # Node.js + Angular CLI
‚îú‚îÄ‚îÄ docker-compose.yml          # Orquestra√ß√£o dos containers
‚îî‚îÄ‚îÄ README.md
```

---

## ü§ù **Contribui√ß√£o**

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

---

## üìù **Licen√ßa**

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

---

## üêõ **Problemas Conhecidos e Solu√ß√µes**

### **Relacionados ao Laravel 5.4**
- **Vers√£o Legada**: Pode ter incompatibilidades com PHP 8+ (usar PHP 7.4)
- **Tokens**: Sistema de autentica√ß√£o simples (sem expira√ß√£o autom√°tica)
- **Helper `now()`**: N√£o existe - usamos `Carbon::now()`

### **Relacionados ao Docker**
- **Permiss√µes**: Container Apache precisa de permiss√µes corretas para `storage/` e `bootstrap/cache/`
- **CORS**: Pode necessitar configura√ß√£o adicional em produ√ß√£o
- **Node modules**: Volume an√¥nimo previne reinstala√ß√£o a cada build

### **Solu√ß√µes Implementadas**
- ‚úÖ **Dockerfile otimizado** com PHP 7.4 + Apache + mod_rewrite
- ‚úÖ **Permiss√µes autom√°ticas** configuradas no docker-compose
- ‚úÖ **DocumentRoot correto** apontando para `/var/www/html/public`
- ‚úÖ **Comando personalizado** para listar rotas compat√≠vel com PHP 7.4+

---

## üìû **Suporte e Troubleshooting**

### **Comandos de Diagn√≥stico**

```bash
# Verificar status dos containers
docker ps

# Ver logs do backend
docker-compose logs backend

# Ver logs do frontend  
docker-compose logs frontend

# Ver logs do banco de dados
docker-compose logs db

# Entrar no container do backend
docker exec -it backend_app bash

# Entrar no container do frontend
docker exec -it frontend_app bash
```

### **Problemas Comuns**

#### **Backend n√£o responde**
```bash
# Verificar se o Apache est√° rodando
docker exec -it backend_app service apache2 status

# Verificar permiss√µes
docker exec -it backend_app ls -la /var/www/html/storage
```

#### **Erro de banco de dados**
```bash
# Verificar se MariaDB est√° rodando
docker exec -it db mysql -u root -proot -e "SHOW DATABASES;"

# Rodar migra√ß√µes novamente
docker exec -it backend_app php artisan migrate
```

#### **Frontend n√£o carrega**
```bash
# Verificar se Node.js est√° instalado
docker exec -it frontend_app node --version

# Reinstalar depend√™ncias
docker exec -it frontend_app npm install
```

### **Em caso de d√∫vidas:**
1. Execute os comandos de diagn√≥stico acima
2. Consulte os logs dos containers
3. Verifique se todas as portas est√£o livres (4200, 8000, 3306)
4. Abra uma issue no reposit√≥rio com os logs de erro

---

## üöÄ **Roadmap - Implementa√ß√µes Futuras**

### üîê **Melhorias de Seguran√ßa**
- **Expira√ß√£o autom√°tica de tokens** - Tokens com TTL configur√°vel
- **Rate limiting avan√ßado** - Prote√ß√£o contra ataques de for√ßa bruta  
- **Refresh tokens** - Sistema de renova√ß√£o segura de tokens
- **Log de auditoria** - Rastreamento de a√ß√µes dos usu√°rios
- **2FA (Two-Factor Authentication)** - Autentica√ß√£o em duas etapas
- **RBAC (Role-Based Access Control)** - Sistema de pap√©is e permiss√µes
- **Criptografia de dados sens√≠veis** - Prote√ß√£o de informa√ß√µes m√©dicas
- **Valida√ß√£o de entrada robusta** - Sanitiza√ß√£o e valida√ß√£o avan√ßada

### üöÄ **Escalabilidade e Performance**
- **Redis para cache** - Cache de consultas e sess√µes
- **Database indexing** - Otimiza√ß√£o de consultas frequentes
- **Compress√£o de resposta** - Gzip/Deflate para APIs
- **Pagina√ß√£o otimizada** - Cursor-based pagination
- **Queue system** - Processamento ass√≠ncrono de tarefas
- **Load balancing** - M√∫ltiplas inst√¢ncias do backend
- **CDN integration** - Distribui√ß√£o de assets est√°ticos
- **Elasticsearch** - Busca avan√ßada e analytics
- **Microservi√ßos** - Separa√ß√£o de responsabilidades

### üß™ **Qualidade de C√≥digo**
- **Testes automatizados** - Unit tests para controllers e models
- **GitHub Actions CI/CD** - Pipeline b√°sico de deploy
- **PHPStan an√°lise est√°tica** - Detec√ß√£o de bugs e type safety
- **ESLint/Prettier** - Padroniza√ß√£o do c√≥digo frontend
- **Integration e E2E tests** - Testes de ponta a ponta
- **Code coverage reporting** - Cobertura m√≠nima de 80%
- **Swagger/OpenAPI** - Documenta√ß√£o autom√°tica da API
- **Conventional commits** - Padr√£o de commits e changelog autom√°tico

### üìä **Monitoramento e Observabilidade**
- **Health checks** - Endpoints de sa√∫de da aplica√ß√£o
- **Logs estruturados** - Logging em formato JSON
- **Error tracking b√°sico** - Captura e notifica√ß√£o de erros
- **Database monitoring** - M√©tricas de performance do DB
- **Prometheus + Grafana** - M√©tricas e dashboards avan√ßados
- **Sentry integration** - Monitoramento de erros em produ√ß√£o
- **APM (Application Performance Monitoring)** - New Relic/DataDog
- **Distributed tracing** - Rastreamento de requisi√ß√µes complexas
- **Real-time alerts** - Notifica√ß√µes proativas de problemas

---

**Desenvolvido para o desafio Ger Financeiro Solu√ß√µes** üöÄ